---
title: èšåˆå‡½æ•°
date: 2024-01-15 10:07:00
permalink: /pages/streamsql-aggregate-functions/
article: false
author: 
  name: StreamSQL
  link: https://github.com/rulego/streamsql
---

# StreamSQL èšåˆå‡½æ•°

èšåˆå‡½æ•°å¯¹ä¸€ç»„å€¼æ‰§è¡Œè®¡ç®—å¹¶è¿”å›å•ä¸ªå€¼ã€‚èšåˆå‡½æ•°åªèƒ½ç”¨åœ¨ä»¥ä¸‹è¡¨è¾¾å¼ä¸­ï¼š
- SELECT è¯­å¥çš„ SELECT åˆ—è¡¨ï¼ˆå­æŸ¥è¯¢æˆ–å¤–éƒ¨æŸ¥è¯¢ï¼‰
- HAVING å­å¥

## SUM - æ±‚å’Œå‡½æ•°
**è¯­æ³•**: `sum(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ•°å€¼çš„æ€»å’Œã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, sum(temperature) as total_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## AVG - å¹³å‡å€¼å‡½æ•°
**è¯­æ³•**: `avg(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ•°å€¼çš„å¹³å‡å€¼ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, avg(temperature) as avg_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## COUNT - è®¡æ•°å‡½æ•°
**è¯­æ³•**: `count(*)`  
**æè¿°**: è¿”å›ç»„ä¸­çš„è¡Œæ•°ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, count(*) as record_count 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## MIN - æœ€å°å€¼å‡½æ•°
**è¯­æ³•**: `min(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ•°å€¼çš„æœ€å°å€¼ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, min(temperature) as min_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## MAX - æœ€å¤§å€¼å‡½æ•°
**è¯­æ³•**: `max(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ•°å€¼çš„æœ€å¤§å€¼ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, max(temperature) as max_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## COLLECT - æ”¶é›†å‡½æ•°
**è¯­æ³•**: `collect(col)`  
**æè¿°**: è·å–å½“å‰çª—å£æ‰€æœ‰æ¶ˆæ¯çš„åˆ—å€¼ç»„æˆçš„æ•°ç»„ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, collect(temperature) as temp_values 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```
## FIRST_VALUE - é¦–å€¼å‡½æ•°
**è¯­æ³•**: `first_value(col) OVER (ORDER BY col)`  
**æè¿°**: è¿”å›çª—å£ä¸­ç¬¬ä¸€è¡Œçš„å€¼ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ

## LAST_VALUE - æœ€åå€¼å‡½æ•°
**è¯­æ³•**: `last_value(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æœ€åä¸€è¡Œçš„å€¼ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, last_value(temperature) as last_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## MERGE_AGG - åˆå¹¶èšåˆå‡½æ•°
**è¯­æ³•**: `merge_agg(col)`  
**æè¿°**: å°†ç»„ä¸­çš„å€¼åˆå¹¶ä¸ºå•ä¸ªå€¼ã€‚å¯¹äºå¯¹è±¡ç±»å‹ï¼Œåˆå¹¶æ‰€æœ‰é”®å€¼å¯¹ï¼›å¯¹äºå…¶ä»–ç±»å‹ï¼Œç”¨é€—å·è¿æ¥ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, merge_agg(status) as all_status 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## DEDUPLICATE - å»é‡å‡½æ•°
**è¯­æ³•**: `deduplicate(col, false)`  
**æè¿°**: è¿”å›å½“å‰ç»„å»é‡çš„ç»“æœï¼Œé€šå¸¸ç”¨åœ¨çª—å£ä¸­ã€‚ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæ˜¯å¦è¿”å›å…¨éƒ¨ç»“æœã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, deduplicate(temperature, true) as unique_temps 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## STDDEV - æ ‡å‡†å·®å‡½æ•°
**è¯­æ³•**: `stddev(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ‰€æœ‰å€¼çš„æ€»ä½“æ ‡å‡†å·®ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒï¼ˆä½¿ç”¨éŸ¦å°”ç¦å¾·ç®—æ³•ä¼˜åŒ–ï¼‰  
**ç¤ºä¾‹**:
```sql
SELECT device, stddev(temperature) as temp_stddev 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## STDDEVS - æ ·æœ¬æ ‡å‡†å·®å‡½æ•°
**è¯­æ³•**: `stddevs(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ‰€æœ‰å€¼çš„æ ·æœ¬æ ‡å‡†å·®ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒï¼ˆä½¿ç”¨éŸ¦å°”ç¦å¾·ç®—æ³•ä¼˜åŒ–ï¼‰  
**ç¤ºä¾‹**:
```sql
SELECT device, stddevs(temperature) as temp_sample_stddev 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## VAR - æ–¹å·®å‡½æ•°
**è¯­æ³•**: `var(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ‰€æœ‰å€¼çš„æ€»ä½“æ–¹å·®ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒï¼ˆä½¿ç”¨éŸ¦å°”ç¦å¾·ç®—æ³•ä¼˜åŒ–ï¼‰  
**ç¤ºä¾‹**:
```sql
SELECT device, var(temperature) as temp_variance 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## VARS - æ ·æœ¬æ–¹å·®å‡½æ•°
**è¯­æ³•**: `vars(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ‰€æœ‰å€¼çš„æ ·æœ¬æ–¹å·®ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒï¼ˆä½¿ç”¨éŸ¦å°”ç¦å¾·ç®—æ³•ä¼˜åŒ–ï¼‰  
**ç¤ºä¾‹**:
```sql
SELECT device, vars(temperature) as temp_sample_variance 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## MEDIAN - ä¸­ä½æ•°å‡½æ•°
**è¯­æ³•**: `median(col)`  
**æè¿°**: è¿”å›ç»„ä¸­æ‰€æœ‰å€¼çš„ä¸­ä½æ•°ã€‚ç©ºå€¼ä¸å‚ä¸è®¡ç®—ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, median(temperature) as temp_median 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## PERCENTILE - ç™¾åˆ†ä½æ•°å‡½æ•°
**è¯­æ³•**: `percentile(col, 0.5)`  
**æè¿°**: è¿”å›ç»„ä¸­æ‰€æœ‰å€¼çš„æŒ‡å®šç™¾åˆ†ä½æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šç™¾åˆ†ä½æ•°çš„å€¼ï¼Œå–å€¼èŒƒå›´ä¸º 0.0 ~ 1.0ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, percentile(temperature, 0.95) as temp_p95 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åˆ†æå‡½æ•°](/pages/streamsql-analytical-functions/) - äº†è§£åˆ†æå‡½æ•°çš„è¯¦ç»†ç”¨æ³•
- [çª—å£å‡½æ•°](/pages/streamsql-window-functions/) - äº†è§£çª—å£å‡½æ•°çš„è¯¦ç»†ç”¨æ³•
- [SQLå‚è€ƒ](/pages/streamsql-sql/) - æŸ¥çœ‹å®Œæ•´çš„SQLè¯­æ³•å‚è€ƒ