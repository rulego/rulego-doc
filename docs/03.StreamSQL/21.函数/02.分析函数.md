---
title: åˆ†æå‡½æ•°
date: 2024-01-15 10:07:00
permalink: /pages/streamsql-analytical-functions/
article: false
author: 
  name: StreamSQL
  link: https://github.com/rulego/streamsql
---

# StreamSQL åˆ†æå‡½æ•°

åˆ†æå‡½æ•°ç”¨äºåœ¨æ•°æ®æµä¸­è¿›è¡Œå¤æ‚çš„åˆ†æè®¡ç®—ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†å’Œå†å²æ•°æ®è®¿é—®ã€‚

## LAG - æ»åå‡½æ•°
**è¯­æ³•**: `lag(col, offset, default_value)`  
**æè¿°**: è¿”å›å½“å‰è¡Œä¹‹å‰çš„ç¬¬Nè¡Œçš„å€¼ã€‚offsetæŒ‡å®šåç§»é‡ï¼Œdefault_valueä¸ºé»˜è®¤å€¼ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, temperature, lag(temperature, 1) as prev_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## LATEST - æœ€æ–°å€¼å‡½æ•°
**è¯­æ³•**: `latest(col)`  
**æè¿°**: è¿”å›æŒ‡å®šåˆ—çš„æœ€æ–°å€¼ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, latest(temperature) as current_temp 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## CHANGED_COL - å˜åŒ–åˆ—å‡½æ•°
**è¯­æ³•**: `changed_col(row_data)`  
**æè¿°**: è¿”å›å‘ç”Ÿå˜åŒ–çš„åˆ—åæ•°ç»„ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, changed_col(*) as changed_columns 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## HAD_CHANGED - å˜åŒ–æ£€æµ‹å‡½æ•°
**è¯­æ³•**: `had_changed(col)`  
**æè¿°**: åˆ¤æ–­æŒ‡å®šåˆ—çš„å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚  
**å¢é‡è®¡ç®—**: âœ… æ”¯æŒ  
**ç¤ºä¾‹**:
```sql
SELECT device, had_changed(status) as status_changed 
FROM stream 
GROUP BY device, TumblingWindow('10s')
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [èšåˆå‡½æ•°](/pages/streamsql-aggregate-functions/) - äº†è§£èšåˆå‡½æ•°çš„è¯¦ç»†ç”¨æ³•
- [çª—å£å‡½æ•°](/pages/streamsql-window-functions/) - äº†è§£çª—å£å‡½æ•°çš„è¯¦ç»†ç”¨æ³•
- [SQLå‚è€ƒ](/pages/streamsql-sql/) - æŸ¥çœ‹å®Œæ•´çš„SQLè¯­æ³•å‚è€ƒ