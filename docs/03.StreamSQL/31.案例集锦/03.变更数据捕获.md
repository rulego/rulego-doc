---
title: å˜æ›´æ•°æ®æ•è·æ¡ˆä¾‹
date: 2024-01-15 10:07:00
permalink: /pages/streamsql-cdc/
article: false
author: 
  name: StreamSQL
  link: https://github.com/rulego/streamsql
---

# å˜æ›´æ•°æ®æ•è·(CDC)æ¡ˆä¾‹

## æ¡ˆä¾‹æ¦‚è¿°

å˜æ›´æ•°æ®æ•è·(Change Data Capture, CDC)æ˜¯ä¸€ç§ç”¨äºè¯†åˆ«å’Œæ•è·æ•°æ®åº“ä¸­æ•°æ®å˜æ›´çš„æŠ€æœ¯ã€‚æœ¬æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨StreamSQLå®ç°å®æ—¶CDCå¤„ç†ã€‚

## æ¡ˆä¾‹1ï¼šç”¨æˆ·ä¿¡æ¯å˜æ›´æ•è·

### ä¸šåŠ¡åœºæ™¯
ç”µå•†ç³»ç»Ÿéœ€è¦å®æ—¶æ•è·ç”¨æˆ·ä¿¡æ¯å˜æ›´ï¼ŒåŒæ­¥åˆ°æ•°æ®ä»“åº“å’Œæ¨èç³»ç»Ÿã€‚

### æ•°æ®è¾“å…¥
```json
{
  "operation": "UPDATE",
  "table": "users",
  "timestamp": "2024-01-15T10:30:00Z",
  "before": {
    "user_id": "U001",
    "name": "John Doe",
    "email": "john@example.com",
    "status": "active",
    "last_login": "2024-01-14T15:20:00Z"
  },
  "after": {
    "user_id": "U001",
    "name": "John Smith",
    "email": "john.smith@example.com",
    "status": "active",
    "last_login": "2024-01-15T10:25:00Z"
  }
}
```

### æœŸæœ›è¾“å‡º
```json
{
  "change_id": "CHG001",
  "user_id": "U001",
  "changed_fields": ["name", "email", "last_login"],
  "change_type": "profile_update",
  "timestamp": "2024-01-15T10:30:00Z",
  "sync_targets": ["data_warehouse", "recommendation_engine"],
  "priority": "medium"
}
```

## æ¡ˆä¾‹2ï¼šè®¢å•çŠ¶æ€å˜æ›´è·Ÿè¸ª

### ä¸šåŠ¡åœºæ™¯
è·Ÿè¸ªè®¢å•çŠ¶æ€å˜æ›´ï¼Œå®æ—¶æ›´æ–°åº“å­˜ã€é€šçŸ¥ç”¨æˆ·å’Œè§¦å‘åç»­æµç¨‹ã€‚

### æ•°æ®è¾“å…¥
```json
{
  "operation": "UPDATE",
  "table": "orders",
  "timestamp": "2024-01-15T10:30:00Z",
  "before": {
    "order_id": "ORD001",
    "status": "pending",
    "amount": 299.99,
    "user_id": "U001"
  },
  "after": {
    "order_id": "ORD001",
    "status": "shipped",
    "amount": 299.99,
    "user_id": "U001",
    "tracking_number": "TRK123456"
  }
}
```

### æœŸæœ›è¾“å‡º
```json
{
  "order_id": "ORD001",
  "status_change": {
    "from": "pending",
    "to": "shipped"
  },
  "actions": [
    {
      "type": "inventory_update",
      "priority": "high"
    },
    {
      "type": "user_notification",
      "template": "order_shipped",
      "data": {
        "tracking_number": "TRK123456"
      }
    }
  ],
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## æ¡ˆä¾‹3ï¼šäº§å“ä»·æ ¼å˜æ›´ç›‘æ§

### ä¸šåŠ¡åœºæ™¯
ç›‘æ§äº§å“ä»·æ ¼å˜æ›´ï¼Œè§¦å‘ä»·æ ¼ç­–ç•¥è°ƒæ•´å’Œç«äº‰åˆ†æã€‚

### æ•°æ®è¾“å…¥
```json
{
  "operation": "UPDATE",
  "table": "products",
  "timestamp": "2024-01-15T10:30:00Z",
  "before": {
    "product_id": "P001",
    "name": "iPhone 15",
    "price": 999.00,
    "category": "electronics"
  },
  "after": {
    "product_id": "P001",
    "name": "iPhone 15",
    "price": 899.00,
    "category": "electronics"
  }
}
```

### æœŸæœ›è¾“å‡º
```json
{
  "product_id": "P001",
  "price_change": {
    "old_price": 999.00,
    "new_price": 899.00,
    "change_percent": -10.01,
    "change_amount": -100.00
  },
  "impact_analysis": {
    "competitor_comparison": "below_market",
    "demand_prediction": "increase",
    "margin_impact": -5.2
  },
  "recommendations": [
    "update_marketing_campaigns",
    "adjust_inventory_levels"
  ],
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## æ¡ˆä¾‹4ï¼šåº“å­˜å˜æ›´å®æ—¶åŒæ­¥

### ä¸šåŠ¡åœºæ™¯
å®æ—¶åŒæ­¥åº“å­˜å˜æ›´åˆ°å¤šä¸ªç³»ç»Ÿï¼Œç¡®ä¿åº“å­˜æ•°æ®ä¸€è‡´æ€§ã€‚

### æ•°æ®è¾“å…¥
```json
{
  "operation": "UPDATE",
  "table": "inventory",
  "timestamp": "2024-01-15T10:30:00Z",
  "before": {
    "product_id": "P001",
    "warehouse_id": "WH001",
    "quantity": 100,
    "reserved": 10
  },
  "after": {
    "product_id": "P001",
    "warehouse_id": "WH001",
    "quantity": 95,
    "reserved": 15
  }
}
```

### æœŸæœ›è¾“å‡º
```json
{
  "product_id": "P001",
  "warehouse_id": "WH001",
  "inventory_change": {
    "quantity_delta": -5,
    "reserved_delta": 5,
    "available_before": 90,
    "available_after": 80
  },
  "sync_status": {
    "ecommerce_platform": "synced",
    "pos_system": "synced",
    "mobile_app": "pending"
  },
  "alerts": [
    {
      "type": "low_stock",
      "threshold": 100,
      "current": 80
    }
  ],
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## æ¡ˆä¾‹5ï¼šç”¨æˆ·æƒé™å˜æ›´å®¡è®¡

### ä¸šåŠ¡åœºæ™¯
å®¡è®¡ç”¨æˆ·æƒé™å˜æ›´ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨å’Œåˆè§„æ€§ã€‚

### æ•°æ®è¾“å…¥
```json
{
  "operation": "UPDATE",
  "table": "user_permissions",
  "timestamp": "2024-01-15T10:30:00Z",
  "before": {
    "user_id": "U001",
    "role": "user",
    "permissions": ["read", "write"]
  },
  "after": {
    "user_id": "U001",
    "role": "admin",
    "permissions": ["read", "write", "delete", "admin"]
  },
  "operator": "ADMIN001"
}
```

### æœŸæœ›è¾“å‡º
```json
{
  "audit_id": "AUD001",
  "user_id": "U001",
  "permission_change": {
    "role_change": {
      "from": "user",
      "to": "admin"
    },
    "added_permissions": ["delete", "admin"],
    "removed_permissions": []
  },
  "risk_assessment": {
    "risk_level": "high",
    "requires_approval": true,
    "compliance_check": "required"
  },
  "operator": "ADMIN001",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## CDCç‰¹ç‚¹

### å®æ—¶æ€§
- **å³æ—¶æ•è·**: æ•°æ®å˜æ›´ç«‹å³è¢«æ•è·
- **ä½å»¶è¿Ÿ**: æ¯«ç§’çº§çš„å˜æ›´ä¼ æ’­
- **é«˜å¯é **: ç¡®ä¿å˜æ›´ä¸ä¸¢å¤±

### æ•°æ®å®Œæ•´æ€§
- **å˜æ›´è¿½è¸ª**: å®Œæ•´è®°å½•æ•°æ®å˜æ›´å†å²
- **çŠ¶æ€å¯¹æ¯”**: æä¾›å˜æ›´å‰åçš„å®Œæ•´çŠ¶æ€
- **æ“ä½œç±»å‹**: åŒºåˆ†INSERTã€UPDATEã€DELETEæ“ä½œ

### åº”ç”¨åœºæ™¯
- **æ•°æ®åŒæ­¥**: å®æ—¶åŒæ­¥åˆ°å¤šä¸ªç³»ç»Ÿ
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æ•°æ®å˜æ›´
- **äº‹ä»¶é©±åŠ¨**: åŸºäºå˜æ›´è§¦å‘ä¸šåŠ¡æµç¨‹
- **å®æ—¶åˆ†æ**: åŸºäºå˜æ›´æ•°æ®è¿›è¡Œå®æ—¶åˆ†æ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®æ—¶æ•°æ®åˆ†æ](/pages/streamsql-realtime-analysis/) - äº†è§£å®æ—¶åˆ†ææŠ€æœ¯
- [ä¸šåŠ¡åœºæ™¯åº”ç”¨](/pages/streamsql-business-scenarios/) - äº†è§£æ›´å¤šä¸šåŠ¡åœºæ™¯
- [SQLå‚è€ƒ](/pages/streamsql-sql/) - æŸ¥çœ‹å®Œæ•´çš„SQLè¯­æ³•å‚è€ƒ
- [æœ€ä½³å®è·µ](/pages/streamsql-best-practices/) - äº†è§£StreamSQLæœ€ä½³å®è·µ