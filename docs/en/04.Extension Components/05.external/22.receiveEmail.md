---
title: Receive Email
article: false
author:
  name: rulego
  link: https://github.com/rulego/rulego
date: 2024-02-23 21:35:33
permalink: /en/pages/receive-email/
---

`x/receiveEmail` component: Receive emails via IMAP protocol. Supports rich email search criteria and dynamic template variables.

## Configuration

### Basic Configuration

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| server | string | IMAP server address, supports ${} variable replacement | None |
| port | int | IMAP port | 993 |
| username | string | Username, supports ${} variable replacement | None |
| password | string | Password, supports ${} variable replacement | None |
| enableTls | bool | Enable TLS | true |
| connectTimeout | int | Connection timeout (seconds) | 10 |

### Search Configuration (search)

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| folder | string | Mail folder name | INBOX |
| since | string | Start date, format: "2006-01-02", supports ${} variable replacement | None |
| before | string | End date, format: "2006-01-02", supports ${} variable replacement | None |
| lastDays | int | Within last N days, takes priority over since/before | None |
| from | string | Sender address or keyword, supports ${} variable replacement | None |
| to | string | Recipient address or keyword, supports ${} variable replacement | None |
| subject | string | Subject keyword, supports ${} variable replacement | None |
| unread | bool | Unread emails only | false |
| limit | int | Maximum number of results, 0 means no limit | None |

### Fetch Configuration (fetch)

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| contentType | string | Content type to fetch: "full"(complete), "headers"(headers only), "body"(body only) | full |
| includeAttachments | bool | Whether to fetch attachments | false |
| maxAttachmentSizeMb | int | Maximum attachment size (MB), larger attachments are skipped, 0 means no attachment content | 0 |
| attachmentSavePath | string | Attachment save path, supports ${} variable replacement, empty means embedded in message | None |

### Post Action Configuration (postAction)

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| action | string | Action type: "none"(none), "markRead"(mark as read), "delete"(delete), "move"(move) | none |
| targetFolder | string | Target mail folder, used for move action | None |

## Relation Type

- ***Success:*** Execution successful, send the message to the `Success` chain
- ***Failure:*** Execution failed, send the message to the `Failure` chain

## Execution Result

After successful execution, the email list data replaces msg.Data with the following format:

```json
{
  "emails": [
    {
      "uid": 12345,
      "messageId": "<abc123@mail.com>",
      "subject": "Email Subject",
      "from": {
        "name": "Sender Name",
        "address": "sender@example.com"
      },
      "to": [
        {"name": "Recipient Name", "address": "receiver@example.com"}
      ],
      "cc": [],
      "date": "2024-02-23T10:00:00Z",
      "body": "Plain text body content",
      "htmlBody": "<html>HTML body</html>",
      "headers": {
        "X-Priority": "1"
      },
      "attachments": [
        {
          "filename": "document.pdf",
          "contentType": "application/pdf",
          "size": 12345,
          "contentBase64": "..."
        }
      ],
      "flags": ["Seen", "Flagged"]
    }
  ],
  "total": 1
}
```

## Configuration Examples

### Example 1: Basic Configuration

```json
{
  "id": "s1",
  "type": "x/receiveEmail",
  "name": "Receive Email",
  "configuration": {
    "server": "imap.gmail.com",
    "port": 993,
    "username": "user@gmail.com",
    "password": "app_password",
    "search": {
      "folder": "INBOX",
      "lastDays": 7,
      "limit": 10
    }
  }
}
```

### Example 2: Using Template Variables

```json
{
  "id": "s2",
  "type": "x/receiveEmail",
  "name": "Receive Email - Dynamic Config",
  "configuration": {
    "server": "${metadata.imapServer}",
    "username": "${metadata.imapUser}",
    "password": "${metadata.imapPassword}",
    "search": {
      "folder": "INBOX",
      "since": "${metadata.sinceDate}",
      "from": "${msg.senderEmail}",
      "subject": "${msg.emailSubject}",
      "unread": true,
      "limit": 50
    },
    "fetch": {
      "contentType": "full",
      "includeAttachments": true,
      "maxAttachmentSizeMb": 10
    }
  }
}
```

### Example 3: With Attachment Saving and Post Action

```json
{
  "id": "s3",
  "type": "x/receiveEmail",
  "name": "Receive and Process Email",
  "configuration": {
    "server": "imap.gmail.com",
    "port": 993,
    "username": "user@gmail.com",
    "password": "app_password",
    "search": {
      "folder": "INBOX",
      "from": "@company.com",
      "unread": true,
      "limit": 20
    },
    "fetch": {
      "contentType": "full",
      "includeAttachments": true,
      "maxAttachmentSizeMb": 20,
      "attachmentSavePath": "/data/attachments/${metadata.tenantId}/"
    },
    "postAction": {
      "action": "markRead"
    }
  }
}
```

### Example 4: Move Email to Archive Folder

```json
{
  "id": "s4",
  "type": "x/receiveEmail",
  "name": "Receive and Archive Email",
  "configuration": {
    "server": "imap.gmail.com",
    "port": 993,
    "username": "user@gmail.com",
    "password": "app_password",
    "search": {
      "folder": "INBOX",
      "lastDays": 30,
      "limit": 100
    },
    "fetch": {
      "contentType": "headers"
    },
    "postAction": {
      "action": "move",
      "targetFolder": "Archive"
    }
  }
}
```

## Application Example

Application example reference: [receiveEmail](https://github.com/rulego/rulego-components/blob/main/examples/email/receive_email.go)

```json
{
  "ruleChain": {
    "id": "chain_receive_email",
    "name": "Email Receiving Chain",
    "root": false,
    "debugMode": false
  },
  "metadata": {
    "nodes": [
      {
        "id": "s1",
        "type": "x/receiveEmail",
        "name": "Receive Unread Emails",
        "debugMode": true,
        "configuration": {
          "server": "imap.gmail.com",
          "port": 993,
          "username": "${metadata.emailUser}",
          "password": "${metadata.emailPassword}",
          "search": {
            "folder": "INBOX",
            "unread": true,
            "limit": 10
          },
          "fetch": {
            "contentType": "full",
            "includeAttachments": true,
            "maxAttachmentSizeMb": 5
          },
          "postAction": {
            "action": "markRead"
          }
        }
      },
      {
        "id": "s2",
        "type": "log",
        "name": "Log",
        "debugMode": true,
        "configuration": {
          "jsScript": "return 'Received email: ' + JSON.stringify(msg);"
        }
      }
    ],
    "connections": [
      {
        "fromId": "s1",
        "toId": "s2",
        "type": "Success"
      }
    ]
  }
}
```

## Notes

1. **Gmail Configuration**: Gmail requires an "App Password" instead of account password, and IMAP must be enabled
2. **Attachment Size**: Large attachments may affect performance, it's recommended to set `maxAttachmentSizeMb` limit
3. **Template Variables**: All fields supporting `${}` syntax can use `metadata.key` or `msg.key` for dynamic replacement
4. **Folder Names**: Different email providers may use different folder names, e.g., Gmail uses "Sent" while others may use "Sent Items"
