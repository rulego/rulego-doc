---
title: File Component
article: false
author: 
  name: rulego
  link: https://github.com/rulego/rulego
date: 2023-09-13 21:32:51
permalink: /en/pages/file/
---

The File component provides read and write operations for local files, supporting file reading, writing, deletion, and list queries.

## 1. File Read (fileRead)

Reads the content of a specified file path. Supports reading a single file or batch reading multiple files using Glob patterns.

### Configuration

| Field | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| path | File path or Glob pattern, supports variable substitution. If it is a relative path, it is relative to `workDir` in context, otherwise it is relative to the process working directory. | string | /tmp/data.txt |
| dataType | Data type, supports `text` and `base64`. | string | text |
| recursive | Whether to search subdirectories recursively. Default is `false`. Only valid when `path` uses Glob pattern. | boolean | false |

### Example

**Read Single File**
```json
{
  "path": "/tmp/data.txt",
  "dataType": "text"
}
```

**Batch Read**
```json
{
  "path": "/tmp/*.log",
  "dataType": "text"
}
```
In batch read mode, contents of multiple files are joined by a newline character `\n`.

## 2. File Write (fileWrite)

Writes data to a specified file.

### Configuration

| Field | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| path | File path, supports variable substitution. If it is a relative path, it is relative to `workDir` in context, otherwise it is relative to the process working directory. | string | /tmp/data.txt |
| content | Content to write, supports variable substitution. | string/binary | ${data} |
| append | Whether to append to the file. | boolean | false |

### Example

```json
{
  "path": "/tmp/output.txt",
  "content": "${data}",
  "append": true
}
```

## 3. File Delete (fileDelete)

Deletes specified files.

### Configuration

| Field | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| path | File path or Glob pattern, supports variable substitution. If it is a relative path, it is relative to `workDir` in context, otherwise it is relative to the process working directory. | string | /tmp/data.txt |

### Output

After successful execution, a `deletedCount` field is added to the metadata, indicating the number of files deleted.

## 4. File List (fileList)

Lists file paths matching a specified pattern.

### Configuration

| Field | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| path | File path pattern, supports variable substitution. If it is a relative path, it is relative to `workDir` in context, otherwise it is relative to the process working directory. | string | /tmp/*.txt |
| recursive | Whether to search subdirectories recursively. | boolean | false |

### Output

Returns a JSON array string containing the file paths.

## 5. Dynamic Paths and Common Functions

Component configurations (such as `path`) support variable substitution and function calls using `${}` syntax. You can use the `now()` function to create time-based folders or files.

*   **now()**
    
    Returns the current time as a `time.Time` value.
    
    Example: `now().Year() == 2024`

For more functions, refer to the [Expr Language Definition](https://expr-lang.org/docs/language-definition).

### Example

Create a file path containing a date:

```text
./${now().Format("20060102")}/data.txt
```

**Content Newline Example**

When writing file content, if you need to add a newline character, you can use the following syntax:

```text
${msg.data+'\n'}
```

## Security and Risk Warnings

The File component provides powerful file system operation capabilities, but also brings potential security risks.

### ‚ö†Ô∏è Risk Warnings

1.  **No Restrictions by Default**: By default (when `filePathWhitelist` is not configured), the File component can access and modify **any file** within the permissions of the running process.
2.  **Accidental Deletion Risk**: When the `fileDelete` component is used with Glob patterns (e.g., `*`), improper configuration may lead to mass accidental deletion of files.
3.  **System File Risk**: If the RuleGo process runs with root or administrator privileges, malicious or incorrect configurations could lead to system critical files (such as `/etc/passwd`, files under `C:\Windows\System32`) being read, modified, or deleted, causing system crashes or sensitive information leakage.

### üõ°Ô∏è Best Practices

To mitigate risks, please follow these best practices:

1.  **Access Control (Whitelist and WorkDir)**
    
    RuleGo provides two mechanisms, **Path Whitelist** and **Working Directory**, to jointly control file access:

    *   **Configure Path Whitelist (Strongly Recommended)**: In production environments, configure `filePathWhitelist` to strictly limit file operations to specific business directories. This is the fundamental line of defense against unauthorized access to system files.
    
        ```go
        // Allow access only to files under /tmp and /var/log/myapp directories
        config.Properties.PutValue("filePathWhitelist", "/tmp,/var/log/myapp,/data/*/log")
        ```
    
    *   **Utilize Working Directory (WorkDir)**: By dynamically setting `workDir`, relative paths can be restricted to a specified directory, enabling secure multi-tenant isolation.

2.  **Multi-tenant Access Control**

    In multi-tenant scenarios, you can dynamically pass `workDir` via `types.WithContext(ctx)` to control the root directory for file operations for the current request. This achieves file isolation between different users or tenants.

    ```go
    // Pass the current tenant's working directory via Context when executing the rule chain
    // KeyWorkDir = "workDir"
    ctx := context.WithValue(context.Background(), "workDir", "/data/tenant_123")
    ruleEngine.OnMsg(msg, types.WithContext(ctx))
    ```

    When the component configuration `path` is a relative path (e.g., `data.txt`), the File component will prioritize resolving it as `${workDir}/data.txt` (e.g., `/data/tenant_123/data.txt`), ensuring that tenants can only access files in their authorized directories.

3.  **Principle of Least Privilege**
    
    Do not run the RuleGo process as root or Administrator. Create a dedicated low-privilege user and grant it read/write permissions only to necessary directories (such as the configured whitelist directories).

4.  **Container Isolation**
    
    It is recommended to run RuleGo in Docker or K8s containers. Use Volume mounts to map only specific host directories into the container, utilizing the isolation features of containers to limit the access range of the file system.

5.  **Input Validation**
    
    If the `path` or `content` fields use variable substitution (e.g., `${data}`), ensure the source of the input data is trustworthy, or strictly validate and sanitize the data in a preceding node of the rule chain to prevent path traversal attacks (although the whitelist mechanism can defend against path traversal, multiple layers of defense are safer).

6.  **Use Glob Deletion with Caution**
    
    When using the `fileDelete` component, try to specify exact file paths. If Glob patterns must be used, ensure rigorous testing and verify that the matching pattern will not accidentally cover parent directories or other important files.
